<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<h:head>
	<title>Evidencias do Projeto GED</title>

	<link rel="
	stylesheet" type="text/css"
		href="/evidencias/css/custom.css" />

</h:head>

<h:body>

	<!-- 1 minuto de monitoramento de idle = 60000 -->
	<!-- 6 minutos de monitoramento de idle = 360000 -->
	<p:idleMonitor timeout="360000">
		<p:ajax event="idle"
			oncomplete="self.location.href = '/evidencias/logout'" />
	</p:idleMonitor>

	<div style="display: inline; vertical-align: middle;">
		<h3 style="display: inline;">Evidências do Projeto GED por
			Atividades no mês</h3>
	</div>

	<div style="display: inline; vertical-align: middle; float: right;">
		<h:outputText value="#{loginController.usuario}" />
		|
		<form style="display: inline;" action="/evidencias/logout"
			method="post">
			<input type="submit" value="Logout" /> <input type="hidden"
				name="#{_csrf.parameterName}" value="#{_csrf.token}" />
		</form>
	</div>

	<p:separator id="separator" />

	<p:dialog id="id-dialog-novo-projeto" widgetVar="dialog-novo-projeto">

		<p:outputPanel id="id-panel-dialog-novo-projeto"
			style="text-align:left;" layout="block">

			<br />
			<p:panelGrid>
				<p:column
					style="font-size: 12px; width: 25%; padding-left:5px; padding-right:5px;"
					headerText="">
				</p:column>

				<p:column
					style="font-size: 12px; width: 20%; padding-left:5px; padding-right:5px;"
					headerText="">
				</p:column>

				<p:column
					style="font-size: 12px; width: 55%; padding-left:5px; padding-right:5px;"
					headerText="">
				</p:column>

			</p:panelGrid>

			<br />
			<p:commandButton value="Salvar" id="ajax"
				actionListener="#{atividadesController.novoProjeto}"
				styleClass="ui-priority-primary"
				onclick="dialog-novo-projeto.hide();">

				<f:attribute name="teste" value="com ajax" />
			</p:commandButton>
			<br />

		</p:outputPanel>

	</p:dialog>


	<h:form id="id-form">

		<!-- spring security -->
		<input type="hidden" name="#{_csrf.parameterName}"
			value="#{_csrf.token}" />

		<p:panel id="id-panel-projetos" header="Lista de Atvidades por projeto Selecionado">
			<p:panelGrid columns="6">

				<p:selectOneMenu converter="projetoConverter"
					value="#{atividadesController.projetoSelecionado}"
					onchange="submit()"
					valueChangeListener="#{atividadesController.atualizarMesesComAtividadesNoProjeto}">

					<f:selectItem
						itemLabel="Projetos Disponíveis 
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			&nbsp;&nbsp;&nbsp;&nbsp;"
						itemValue="" />

					<f:selectItems value="#{atividadesController.projetos}" />

				</p:selectOneMenu>

				<p:commandButton value="Novo" type="button"
					onclick="PF('dialog-novo-projeto').show();"
					style="margin-right: 10px;" />

				<p:selectOneMenu id="id-mesComAtividadesDoProjeto"
					converter="mesComAtividadesDoProjetoConverter"
					value="#{atividadesController.mesComAtividadesDoProjetoSelecionado}"
					onchange="submit()"
					valueChangeListener="#{atividadesController.atualizarAtividadesNoMes}">

					<f:selectItem
						itemLabel="Meses com Atividades no Projeto 
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			&nbsp;&nbsp;&nbsp;&nbsp;"
						itemValue="" />

					<f:selectItems
						value="#{atividadesController.mesesComAtividadesNoProjeto}" />

				</p:selectOneMenu>

				<p:commandButton value="Nova" type="button"
					onclick="PF('dialog-nova-atividade').show();"
					style="margin-right: 10px;" />
			</p:panelGrid>

			<p:accordionPanel value="#{atividadesController.atividades}"
				var="atividade" id="id-accordion" widgetVar="accordion"
				activeIndex="-1">
				<p:ajax event="tabChange"
					listener="#{atividadesController.onTabChange()}" />
				<p:tab id="id-tab" title="#{atividade.descricao}">
					<p:panel id="id-panel">

						<p:commandButton value="Ajax Submit" id="ajax"
							actionListener="#{buttonView.buttonAction}"
							styleClass="ui-priority-primary">

							<f:attribute name="teste" value="com ajax" />
						</p:commandButton>

						<p:commandButton value="Non-Ajax Submit" id="nonAjax"
							actionListener="#{buttonView.buttonAction}" ajax="false">

							<f:attribute name="teste" value="sem ajax" />
						</p:commandButton>

					</p:panel>

				</p:tab>
			</p:accordionPanel>
		</p:panel>
		<p:dialog header="Nova Atividade" widgetVar="dialog-nova-atividade"
			minHeight="40">
			<h:outputText value="Nova Atividade..." />
		</p:dialog>
		<p:dialog header="Novo Projeto" widgetVar="dialog-novo-projeto"
			minHeight="40">
			<h:outputText value="Novo Projeto..." />
		</p:dialog>

	</h:form>


</h:body>
</html>